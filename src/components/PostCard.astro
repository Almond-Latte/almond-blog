---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BudouX from './BudouX.astro';
import FormattedDate from './FormattedDate.astro';

type PostWithExtras = CollectionEntry<'blog'> & { readingTime: number };

interface Props {
	post: PostWithExtras;
	titleTag?: 'h2' | 'h3' | 'h4';
}

const { post, titleTag = 'h4' } = Astro.props;
---

<a class="post-card-media" href={`/blog/${post.id}/`}>
	{post.data.heroImage ? (
		<Image width={720} height={360} src={post.data.heroImage} alt={post.data.title} />
	) : (
		<img width={720} height={360} src={`/og/${post.id}.png`} alt={post.data.title} />
	)}
</a>
<div class="post-card-body">
	<a class="post-card-title-link" href={`/blog/${post.id}/`}>
		<div class="title-row">
			<BudouX text={post.data.title} tag={titleTag} class="title" />
			{post.data.htbStatus === 'active' && (
				<span class="coming-soon-badge">Coming Soon</span>
			)}
		</div>
	</a>
	<slot />
	<p class="date">
		<FormattedDate date={post.data.pubDate} />
		<span class="reading-time">{post.readingTime} min read</span>
	</p>
	{post.data.tags?.length > 0 && (
		<ul class="tags">
			{post.data.tags.slice(0, 3).map((tag) => (
				<li>
					<a class="tag" href={`/tags/${encodeURIComponent(tag)}/`}>#{tag}</a>
				</li>
			))}
			{post.data.tags.length > 3 && (
				<li class="tag-more">+{post.data.tags.length - 3}</li>
			)}
		</ul>
	)}
</div>

<style>
	.post-card-media {
		display: block;
	}
	.post-card-media img {
		width: 100%;
		height: auto;
		object-fit: cover;
		border-radius: 12px;
	}
	.post-card-title-link {
		text-decoration: none;
	}
	.title-row {
		display: flex;
		align-items: center;
		gap: 0.5em;
	}
	.coming-soon-badge {
		flex-shrink: 0;
		background: var(--htb-green);
		color: #111;
		font-size: 0.65em;
		font-weight: 700;
		padding: 0.2em 0.6em;
		border-radius: 6px;
		white-space: nowrap;
	}
	:global(.title) {
		margin: 0;
		color: rgb(var(--gray));
		font-size: 1rem;
		font-weight: normal;
		line-height: 1.4;
	}
	.date {
		margin: 0.4em 0 0;
		color: rgb(var(--gray));
	}
	.reading-time {
		margin-left: 0.6em;
		font-size: 0.85em;
		color: rgb(var(--gray));
	}
	.tags {
		display: inline-flex;
		justify-content: flex-start;
		flex-wrap: wrap;
		gap: 0.4em;
		margin: 0.6em 0 0;
		padding: 0;
		list-style: none;
	}
	.tag {
		display: inline-block;
		padding: 0.2em 0.6em;
		border-radius: 999px;
		background: rgba(var(--gray-light), 0.8);
		color: rgb(var(--gray-dark));
		font-size: 0.8em;
		text-decoration: none;
	}
	.tag:hover {
		color: rgb(var(--accent));
	}
	.tag-more {
		display: inline-flex;
		align-items: center;
		padding: 0.2em 0.6em;
		border-radius: 999px;
		background: rgba(var(--gray-light), 0.6);
		color: rgb(var(--gray));
		font-size: 0.8em;
	}
</style>
